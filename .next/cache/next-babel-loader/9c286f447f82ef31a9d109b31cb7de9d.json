{"ast":null,"code":"import sqlite from 'sqlite';\nexport default (async (req, res) => {\n  res.statusCode = 200;\n  const db = await sqlite.open('./library.sqlite');\n  const reqBody = JSON.parse(req.body);\n  let bookIds = '';\n  console.log(`reqBodyreqBody---->${reqBody}`);\n\n  if (reqBody.cartData.length > 0) {\n    for (let index = 0; index < reqBody.length; index++) {\n      const statement = await db.prepare('UPDATE books SET availableQty= ? where bookId= ? ');\n      const result = await statement.run(reqBody[index].availableQty - 1, reqBody[index].bookId);\n      result.finalize();\n      if (bookIds.length === 0) bookIds = reqBody[index].bookId.toString();else bookIds.concat(`${reqBody[index].bookId}`);\n    }\n  }\n\n  console.log(`bookIdsbookIdsbookIds---->${bookIds}`);\n  const userUpdateStatement = await db.prepare('UPDATE Users SET bookIds= ? where userId= ? ');\n  const userUpdateResult = await userUpdateStatement.run(bookIds, reqBody.userId);\n  userUpdateResult.finalize();\n  res.json({\n    data: 'Borrowed succesfully'\n  });\n});","map":{"version":3,"sources":["/Users/Abhipray 1/Desktop/MY home/mYY work/HEXAD_assignment/Hexad_trial_code/hexd/pages/api/borrowBooks.js"],"names":["sqlite","req","res","statusCode","db","open","reqBody","JSON","parse","body","bookIds","console","log","cartData","length","index","statement","prepare","result","run","availableQty","bookId","finalize","toString","concat","userUpdateStatement","userUpdateResult","userId","json","data"],"mappings":"AAAA,OAAOA,MAAP,MAAmB,QAAnB;AAEA,gBAAe,OAAOC,GAAP,EAAYC,GAAZ,KAAoB;AACjCA,EAAAA,GAAG,CAACC,UAAJ,GAAiB,GAAjB;AACA,QAAMC,EAAE,GAAG,MAAMJ,MAAM,CAACK,IAAP,CAAY,kBAAZ,CAAjB;AACA,QAAMC,OAAO,GAAGC,IAAI,CAACC,KAAL,CAAWP,GAAG,CAACQ,IAAf,CAAhB;AACA,MAAIC,OAAO,GAAG,EAAd;AAEAC,EAAAA,OAAO,CAACC,GAAR,CAAa,sBAAqBN,OAAQ,EAA1C;;AAEA,MAAIA,OAAO,CAACO,QAAR,CAAiBC,MAAjB,GAA0B,CAA9B,EAAiC;AAC/B,SAAK,IAAIC,KAAK,GAAG,CAAjB,EAAoBA,KAAK,GAAGT,OAAO,CAACQ,MAApC,EAA4CC,KAAK,EAAjD,EAAqD;AACjD,YAAMC,SAAS,GAAG,MAAMZ,EAAE,CAACa,OAAH,CAAW,mDAAX,CAAxB;AACA,YAAMC,MAAM,GAAG,MAAMF,SAAS,CAACG,GAAV,CACjBb,OAAO,CAACS,KAAD,CAAP,CAAeK,YAAf,GAA4B,CADX,EAEjBd,OAAO,CAACS,KAAD,CAAP,CAAeM,MAFE,CAArB;AAIAH,MAAAA,MAAM,CAACI,QAAP;AACA,UAAIZ,OAAO,CAACI,MAAR,KAAmB,CAAvB,EACIJ,OAAO,GAAGJ,OAAO,CAACS,KAAD,CAAP,CAAeM,MAAf,CAAsBE,QAAtB,EAAV,CADJ,KAGIb,OAAO,CAACc,MAAR,CAAgB,GAAElB,OAAO,CAACS,KAAD,CAAP,CAAeM,MAAO,EAAxC;AACP;AACF;;AAEDV,EAAAA,OAAO,CAACC,GAAR,CAAa,6BAA4BF,OAAQ,EAAjD;AAEA,QAAMe,mBAAmB,GAAG,MAAMrB,EAAE,CAACa,OAAH,CAAW,8CAAX,CAAlC;AACA,QAAMS,gBAAgB,GAAG,MAAMD,mBAAmB,CAACN,GAApB,CAC3BT,OAD2B,EAE3BJ,OAAO,CAACqB,MAFmB,CAA/B;AAIAD,EAAAA,gBAAgB,CAACJ,QAAjB;AAEApB,EAAAA,GAAG,CAAC0B,IAAJ,CAAS;AACPC,IAAAA,IAAI,EAAE;AADC,GAAT;AAGD,CAnCD","sourcesContent":["import sqlite from 'sqlite';\n\nexport default async (req, res) => {\n  res.statusCode = 200;\n  const db = await sqlite.open('./library.sqlite');\n  const reqBody = JSON.parse(req.body);\n  let bookIds = ''\n\n  console.log(`reqBodyreqBody---->${reqBody}`);\n\n  if (reqBody.cartData.length > 0) {\n    for (let index = 0; index < reqBody.length; index++) {\n        const statement = await db.prepare('UPDATE books SET availableQty= ? where bookId= ? ');\n        const result = await statement.run(\n            reqBody[index].availableQty-1,\n            reqBody[index].bookId,\n        )\n        result.finalize();\n        if (bookIds.length === 0)\n            bookIds = reqBody[index].bookId.toString()\n        else\n            bookIds.concat(`${reqBody[index].bookId}`)\n    }\n  }\n\n  console.log(`bookIdsbookIdsbookIds---->${bookIds}`);\n\n  const userUpdateStatement = await db.prepare('UPDATE Users SET bookIds= ? where userId= ? ');\n  const userUpdateResult = await userUpdateStatement.run(\n      bookIds,\n      reqBody.userId,\n  )\n  userUpdateResult.finalize();\n\n  res.json({ \n    data: 'Borrowed succesfully'\n  });\n}\n"]},"metadata":{},"sourceType":"module"}