{"ast":null,"code":"import _toConsumableArray from \"/Users/Abhipray 1/Desktop/MY home/mYY work/HEXAD_assignment/Hexad_trial_code/hexd/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _regeneratorRuntime from \"/Users/Abhipray 1/Desktop/MY home/mYY work/HEXAD_assignment/Hexad_trial_code/hexd/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/Users/Abhipray 1/Desktop/MY home/mYY work/HEXAD_assignment/Hexad_trial_code/hexd/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _classCallCheck from \"/Users/Abhipray 1/Desktop/MY home/mYY work/HEXAD_assignment/Hexad_trial_code/hexd/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/Users/Abhipray 1/Desktop/MY home/mYY work/HEXAD_assignment/Hexad_trial_code/hexd/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport _assertThisInitialized from \"/Users/Abhipray 1/Desktop/MY home/mYY work/HEXAD_assignment/Hexad_trial_code/hexd/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";\nimport _inherits from \"/Users/Abhipray 1/Desktop/MY home/mYY work/HEXAD_assignment/Hexad_trial_code/hexd/node_modules/@babel/runtime/helpers/esm/inherits\";\nimport _possibleConstructorReturn from \"/Users/Abhipray 1/Desktop/MY home/mYY work/HEXAD_assignment/Hexad_trial_code/hexd/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";\nimport _getPrototypeOf from \"/Users/Abhipray 1/Desktop/MY home/mYY work/HEXAD_assignment/Hexad_trial_code/hexd/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";\nimport _defineProperty from \"/Users/Abhipray 1/Desktop/MY home/mYY work/HEXAD_assignment/Hexad_trial_code/hexd/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/Abhipray 1/Desktop/MY home/mYY work/HEXAD_assignment/Hexad_trial_code/hexd/client/modules/listing/index.js\";\n\nfunction _createSuper(Derived) { var hasNativeReflectConstruct = _isNativeReflectConstruct(); return function _createSuperInternal() { var Super = _getPrototypeOf(Derived), result; if (hasNativeReflectConstruct) { var NewTarget = _getPrototypeOf(this).constructor; result = Reflect.construct(Super, arguments, NewTarget); } else { result = Super.apply(this, arguments); } return _possibleConstructorReturn(this, result); }; }\n\nfunction _isNativeReflectConstruct() { if (typeof Reflect === \"undefined\" || !Reflect.construct) return false; if (Reflect.construct.sham) return false; if (typeof Proxy === \"function\") return true; try { Date.prototype.toString.call(Reflect.construct(Date, [], function () {})); return true; } catch (e) { return false; } }\n\nimport React, { Component } from 'react';\nimport styles from './styles.module.scss';\nimport BookComp from '../../components/book';\nimport NoResults from '../../components/noResults';\nimport Slider from '../../components/Slider';\nimport { fetchService } from '../../common/utils';\n\nvar ListingModule = /*#__PURE__*/function (_Component) {\n  _inherits(ListingModule, _Component);\n\n  var _super = _createSuper(ListingModule);\n\n  function ListingModule(props) {\n    var _this;\n\n    _classCallCheck(this, ListingModule);\n\n    _this = _super.call(this, props);\n\n    _defineProperty(_assertThisInitialized(_this), \"getBooksList\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var apiUrl, response;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              apiUrl = '/api/getBooksList'; // fetch(apiUrl).then(res => res.json())\n              //   .then(response => {\n              // this.setState({\n              //     bookList: response.data,\n              // })\n              //   })\n\n              _context.next = 3;\n              return fetchService({\n                apiUrl: '/api/getBooksList',\n                method: 'GET'\n              });\n\n            case 3:\n              response = _context.sent;\n              if (response.data) _this.setState({\n                bookList: response.data || []\n              });\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"getUserDetails\", /*#__PURE__*/_asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2() {\n      var userDetails, apiUrl, response;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              userDetails = _this.state.userDetails;\n              apiUrl = '/api/getUserDetails'; // const fetchData = {\n              //     method: 'POST',\n              //     body: JSON.stringify({userId: userDetails.userId}),\n              //     headers: new Headers()\n              //   }\n              // fetch(apiUrl, fetchData).then(res => res.json())\n              //   .then(response => {\n              //     this.setState({\n              //         userDetails: response.data,\n              //     })\n              //   })\n\n              _context2.next = 4;\n              return fetchService({\n                apiUrl: '/api/getBooksList',\n                method: 'POST',\n                reqData: JSON.stringify({\n                  userId: userDetails.userId\n                })\n              });\n\n            case 4:\n              response = _context2.sent;\n              if (response.data) _this.setState({\n                userDetails: response.data\n              });\n\n            case 6:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2);\n    })));\n\n    _defineProperty(_assertThisInitialized(_this), \"addToCart\", function (bookDetails) {\n      var _this$state = _this.state,\n          bookList = _this$state.bookList,\n          cart = _this$state.cart;\n\n      if (cart.length < 2 && bookDetails.availableQty > 0) {\n        if (cart.length === 0 || cart.length > 0 && cart.some(function (bookInCart) {\n          return bookInCart.bookId !== bookDetails.bookId;\n        })) {\n          var updatedBookList = bookList.map(function (book) {\n            if (book.bookId === bookDetails.bookId) {\n              book.isSelected = 1;\n            }\n\n            return book;\n          });\n\n          _this.setState({\n            bookList: updatedBookList,\n            cart: [].concat(_toConsumableArray(cart), [bookDetails])\n          });\n        }\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"removeFromCart\", function (bookDetails) {\n      var _this$state2 = _this.state,\n          bookList = _this$state2.bookList,\n          cart = _this$state2.cart;\n\n      if (cart.length > 0) {\n        var updatedBookList = bookList.map(function (book) {\n          if (book.bookId === bookDetails.bookId) book.isSelected = 0;\n          return book;\n        });\n        var updatedCart = cart.filter(function (item) {\n          return item.bookId !== bookDetails.bookId;\n        });\n\n        _this.setState({\n          bookList: updatedBookList,\n          cart: updatedCart\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"borrowBook\", function () {\n      var _this$state3 = _this.state,\n          cart = _this$state3.cart,\n          userDetails = _this$state3.userDetails;\n      console.log(cart);\n      var borrowApiUrl = '/api/borrowBooks';\n      var fetchData = {\n        method: 'PUT',\n        body: JSON.stringify({\n          cartData: cart,\n          userId: userDetails.userId\n        }),\n        headers: new Headers()\n      };\n      fetch(borrowApiUrl, fetchData).then(function (res) {\n        return res.json();\n      }).then(function (response) {\n        if (response.maxLimit || response.existInBorrow) {\n          _this.setState({\n            borrowMsg: response.data\n          });\n        } else {\n          _this.getBooksList();\n\n          _this.getUserDetails();\n\n          _this.setState({\n            cart: [],\n            borrowMsg: ''\n          });\n        }\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"returnBook\", function (returnBook) {\n      var _this$state4 = _this.state,\n          cart = _this$state4.cart,\n          userDetails = _this$state4.userDetails;\n      console.log(cart);\n      var borrowApiUrl = '/api/returnBook';\n\n      if (returnBook.bookId) {\n        var fetchData = {\n          method: 'PUT',\n          body: JSON.stringify({\n            cartData: returnBook,\n            userId: userDetails.userId\n          }),\n          headers: new Headers()\n        };\n        fetch(borrowApiUrl, fetchData).then(function (res) {\n          return res.json();\n        }).then(function (response) {\n          console.log(response.data);\n\n          _this.getBooksList();\n\n          _this.getUserDetails();\n\n          _this.setState({\n            returnMsg: response.data\n          });\n        });\n      }\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"toggleCart\", function () {\n      var showCart = _this.state.showCart;\n\n      _this.setState({\n        showCart: !showCart,\n        borrowMsg: ''\n      });\n    });\n\n    _defineProperty(_assertThisInitialized(_this), \"toggleReturn\", function () {\n      var showReturn = _this.state.showReturn;\n\n      _this.setState({\n        showReturn: !showReturn,\n        returnMsg: ''\n      });\n    });\n\n    _this.state = {\n      cart: [],\n      bookList: [],\n      showCart: false,\n      showReturn: false,\n      userDetails: {\n        userId: 808,\n        userName: '',\n        bookIds: ''\n      },\n      borrowMsg: '',\n      returnMsg: ''\n    };\n    return _this;\n  }\n\n  _createClass(ListingModule, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.getBooksList();\n      this.getUserDetails();\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var _this2 = this;\n\n      var _this$state5 = this.state,\n          _this$state5$bookList = _this$state5.bookList,\n          bookList = _this$state5$bookList === void 0 ? [] : _this$state5$bookList,\n          _this$state5$cart = _this$state5.cart,\n          cart = _this$state5$cart === void 0 ? [] : _this$state5$cart,\n          showCart = _this$state5.showCart,\n          showReturn = _this$state5.showReturn,\n          userDetails = _this$state5.userDetails,\n          returnMsg = _this$state5.returnMsg,\n          borrowMsg = _this$state5.borrowMsg;\n      var userBookIdList = [];\n      if (userDetails && userDetails.bookIds.length > 0) userBookIdList = userDetails.bookIds.includes(',') ? userDetails.bookIds.split(',') : [userDetails.bookIds];\n      var returnItemToShow = userBookIdList.length > 0 && bookList.length > 0 ? bookList.filter(function (book) {\n        return book.bookId === parseInt(userBookIdList[0]) || book.bookId === parseInt(userBookIdList[1]);\n      }) : [];\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles.listing,\n        children: [showCart && /*#__PURE__*/_jsxDEV(Slider, {\n          sliderItems: cart,\n          removeFromSlider: this.removeFromCart,\n          borrowBook: this.borrowBook,\n          hideSlider: this.toggleCart,\n          showCustomMsg: borrowMsg\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 188,\n          columnNumber: 21\n        }, this), showReturn && /*#__PURE__*/_jsxDEV(Slider, {\n          sliderTitleText: \"Return List\",\n          sliderItems: returnItemToShow,\n          removeFromSlider: this.returnBook,\n          borrowBook: this.borrowBook,\n          hideSlider: this.toggleReturn,\n          hideMainCta: true,\n          showCustomMsg: returnMsg\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 197,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: styles.listing__title,\n          children: \"Book Listing\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: styles.listing__cartReturn,\n          children: [/*#__PURE__*/_jsxDEV(\"span\", {\n            className: styles.listing__actionIcon,\n            children: [/*#__PURE__*/_jsxDEV(\"img\", {\n              src: \"https://res.cloudinary.com/abyy30/image/upload/v1608744183/bookReturn_rdtuxi.svg\",\n              onClick: function onClick() {\n                return _this2.toggleReturn();\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 212,\n              columnNumber: 25\n            }, this), returnItemToShow.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n              children: returnItemToShow.length\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 213,\n              columnNumber: 57\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 211,\n            columnNumber: 21\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: styles.listing__actionIcon,\n            children: [/*#__PURE__*/_jsxDEV(\"img\", {\n              src: \"https://res.cloudinary.com/abyy30/image/upload/v1608742866/cartOutline_oewduu.svg\",\n              onClick: function onClick() {\n                return _this2.toggleCart();\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 216,\n              columnNumber: 25\n            }, this), cart.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n              children: cart.length\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 217,\n              columnNumber: 45\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 215,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 210,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: styles.listing__subTitle,\n          children: \"Hover or Tap to select your desired book\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: styles.listing__bookListWrap,\n          children: bookList.length > 0 ? bookList.map(function (book) {\n            if (book.availableQty > 0) {\n              return /*#__PURE__*/_jsxDEV(\"div\", {\n                className: styles.listing__bookWrap,\n                children: /*#__PURE__*/_jsxDEV(BookComp, {\n                  bookDetails: book,\n                  addToCart: _this2.addToCart,\n                  removeFromCart: _this2.removeFromCart\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 230,\n                  columnNumber: 45\n                }, _this2)\n              }, book.bookId, false, {\n                fileName: _jsxFileName,\n                lineNumber: 229,\n                columnNumber: 41\n              }, _this2);\n            }\n          }) : /*#__PURE__*/_jsxDEV(NoResults, {\n            textToShow: \"No books found\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 236,\n            columnNumber: 23\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 17\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 13\n      }, this);\n    }\n  }]);\n\n  return ListingModule;\n}(Component);\n\nexport default ListingModule;","map":{"version":3,"sources":["/Users/Abhipray 1/Desktop/MY home/mYY work/HEXAD_assignment/Hexad_trial_code/hexd/client/modules/listing/index.js"],"names":["React","Component","styles","BookComp","NoResults","Slider","fetchService","ListingModule","props","apiUrl","method","response","data","setState","bookList","userDetails","state","reqData","JSON","stringify","userId","bookDetails","cart","length","availableQty","some","bookInCart","bookId","updatedBookList","map","book","isSelected","updatedCart","filter","item","console","log","borrowApiUrl","fetchData","body","cartData","headers","Headers","fetch","then","res","json","maxLimit","existInBorrow","borrowMsg","getBooksList","getUserDetails","returnBook","returnMsg","showCart","showReturn","userName","bookIds","userBookIdList","includes","split","returnItemToShow","parseInt","listing","removeFromCart","borrowBook","toggleCart","toggleReturn","listing__title","listing__cartReturn","listing__actionIcon","listing__subTitle","listing__bookListWrap","listing__bookWrap","addToCart"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport styles from './styles.module.scss';\nimport BookComp from '../../components/book'\nimport NoResults from '../../components/noResults';\nimport Slider from '../../components/Slider';\nimport { fetchService } from '../../common/utils'\n\nclass ListingModule extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            cart: [],\n            bookList: [],\n            showCart: false,\n            showReturn: false,\n            userDetails: {\n                userId: 808,\n                userName: '',\n                bookIds: '',\n            },\n            borrowMsg: '',\n            returnMsg: '',\n        }\n    }\n\n    componentDidMount() {\n        this.getBooksList();\n        this.getUserDetails();\n    }\n\n    getBooksList = async () => {\n        const apiUrl = '/api/getBooksList';\n        // fetch(apiUrl).then(res => res.json())\n        //   .then(response => {\n            // this.setState({\n            //     bookList: response.data,\n            // })\n        //   })\n        const response = await fetchService({\n            apiUrl: '/api/getBooksList',\n            method: 'GET'\n        });\n        if (response.data)\n            this.setState({\n                bookList: response.data || [],\n            });\n    }\n\n    getUserDetails = async () => {\n        const { userDetails } = this.state;\n        const apiUrl = '/api/getUserDetails';\n\n        // const fetchData = {\n        //     method: 'POST',\n        //     body: JSON.stringify({userId: userDetails.userId}),\n        //     headers: new Headers()\n        //   }\n        // fetch(apiUrl, fetchData).then(res => res.json())\n        //   .then(response => {\n        //     this.setState({\n        //         userDetails: response.data,\n        //     })\n        //   })\n\n        const response = await fetchService({\n            apiUrl: '/api/getBooksList',\n            method: 'POST',\n            reqData: JSON.stringify({userId: userDetails.userId})\n        });\n        if (response.data)\n            this.setState({\n                userDetails: response.data,\n            })\n    }\n    \n    addToCart = bookDetails => {\n        const { bookList, cart } = this.state;\n        if (cart.length < 2 && bookDetails.availableQty > 0) {\n            if (cart.length === 0 || \n                (cart.length > 0 && \n                    cart.some(bookInCart => bookInCart.bookId !== bookDetails.bookId))) {\n                const updatedBookList = bookList.map(book => {\n                    if (book.bookId === bookDetails.bookId) {\n                        book.isSelected = 1\n                    }\n                    return book\n                })\n                this.setState({\n                    bookList: updatedBookList,\n                    cart: [...cart, bookDetails],\n                })\n            }\n        }\n    };\n\n    removeFromCart = bookDetails => {\n        const { bookList, cart } = this.state;\n        if (cart.length > 0) {\n            const updatedBookList = bookList.map(book => {\n                if (book.bookId === bookDetails.bookId)\n                    book.isSelected = 0\n                return book\n            })\n            const updatedCart = cart.filter(item => item.bookId !== bookDetails.bookId)\n            this.setState({\n                bookList: updatedBookList,\n                cart: updatedCart,\n            })\n        }\n    };\n\n    borrowBook = () => {\n        const { cart, userDetails } = this.state;\n        console.log(cart);\n        const borrowApiUrl = '/api/borrowBooks';\n        const fetchData = {\n            method: 'PUT',\n            body: JSON.stringify({cartData: cart, userId: userDetails.userId}),\n            headers: new Headers()\n          }\n        fetch(borrowApiUrl, fetchData).then(res => res.json())\n          .then(response => {\n            if (response.maxLimit || response.existInBorrow) {\n                this.setState({\n                    borrowMsg: response.data,\n                })\n            } else {\n                this.getBooksList();\n                this.getUserDetails();\n                this.setState({\n                    cart: [],\n                    borrowMsg: '',\n                })\n            }\n          })\n    };\n\n    returnBook = (returnBook) => {\n        const { cart, userDetails } = this.state;\n        console.log(cart);\n        const borrowApiUrl = '/api/returnBook';\n        if (returnBook.bookId) {\n            const fetchData = {\n                method: 'PUT',\n                body: JSON.stringify({cartData: returnBook, userId: userDetails.userId}),\n                headers: new Headers()\n              }\n            fetch(borrowApiUrl, fetchData).then(res => res.json())\n              .then(response => {\n                console.log(response.data);\n                this.getBooksList();\n                this.getUserDetails();\n                this.setState({\n                    returnMsg: response.data,\n                })\n              })\n        }\n    };\n\n    toggleCart = () => {\n        const { showCart } = this.state;\n        this.setState({\n            showCart: !showCart,\n            borrowMsg: '',\n        })\n    };\n\n    toggleReturn = () => {\n        const { showReturn } = this.state;\n        this.setState({\n            showReturn: !showReturn,\n            returnMsg: '',\n        })\n    };\n\n    render() {\n        const { bookList = [], cart = [], showCart, showReturn, userDetails, returnMsg, borrowMsg } = this.state;\n\n        let userBookIdList = [];\n        if (userDetails && userDetails.bookIds.length > 0)\n            userBookIdList = userDetails.bookIds.includes(',') ? userDetails.bookIds.split(',') : [userDetails.bookIds];\n\n        const returnItemToShow = (userBookIdList.length > 0 && bookList.length > 0) ? bookList.filter(book => (book.bookId === parseInt(userBookIdList[0]) || book.bookId === parseInt(userBookIdList[1]))) : [];\n\n        return (\n            <div className={styles.listing}>\n                {showCart && \n                    <Slider \n                        sliderItems={cart}\n                        removeFromSlider={this.removeFromCart}\n                        borrowBook={this.borrowBook}\n                        hideSlider={this.toggleCart}\n                        showCustomMsg={borrowMsg} \n                    />\n                }\n                {showReturn &&\n                    <Slider\n                        sliderTitleText='Return List'\n                        sliderItems={returnItemToShow}\n                        removeFromSlider={this.returnBook}\n                        borrowBook={this.borrowBook}\n                        hideSlider={this.toggleReturn}\n                        hideMainCta\n                        showCustomMsg={returnMsg}\n                    />\n                }\n                <div className={styles.listing__title}>\n                    Book Listing\n                </div>\n                <div className={styles.listing__cartReturn}>\n                    <span className={styles.listing__actionIcon}>\n                        <img src=\"https://res.cloudinary.com/abyy30/image/upload/v1608744183/bookReturn_rdtuxi.svg\" onClick={() => this.toggleReturn()} />\n                        {returnItemToShow.length > 0 && <div>{returnItemToShow.length}</div>}\n                    </span>\n                    <span className={styles.listing__actionIcon}>\n                        <img src=\"https://res.cloudinary.com/abyy30/image/upload/v1608742866/cartOutline_oewduu.svg\" onClick={() => this.toggleCart()} />\n                        {cart.length > 0 && <div>{cart.length}</div>}\n                    </span>\n                </div>\n                <div className={styles.listing__subTitle}>\n                    Hover or Tap to select your desired book\n                </div>\n                <div className={styles.listing__bookListWrap}>\n                    {bookList.length > 0 ? \n                        bookList.map(book => \n                            {\n                                if (book.availableQty > 0) {\n                                    return (\n                                        <div className={styles.listing__bookWrap} key={book.bookId}>\n                                            <BookComp bookDetails={book} addToCart={this.addToCart} removeFromCart={this.removeFromCart} />\n                                        </div>\n                                    )\n                                }\n                            }\n                        )\n                    : <NoResults textToShow='No books found' />\n                    }\n                </div>\n            </div>\n        );\n    }\n}\n\nexport default ListingModule;"]},"metadata":{},"sourceType":"module"}