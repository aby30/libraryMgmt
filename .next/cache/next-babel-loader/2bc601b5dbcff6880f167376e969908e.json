{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/Abhipray 1/Desktop/MY home/mYY work/HEXAD_assignment/Hexad_trial_code/hexad/client/modules/listing/index.js\";\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { Component } from 'react';\nimport BookComp from '../../components/book';\nimport EmptyScreenWithMsg from '../../components/emptyScreenWithMsg';\nimport Slider from '../../components/Slider';\nimport styles from './styles.module.scss';\n\nclass ListingModule extends Component {\n  constructor(props) {\n    super(props);\n\n    _defineProperty(this, \"getBooksList\", () => {\n      this.setState({\n        loadingState: true\n      });\n      const apiUrl = '/api/getBooksList';\n      fetch(apiUrl).then(res => res.json()).then(response => {\n        this.setState({\n          bookList: response.data,\n          loadingState: false\n        });\n      });\n    });\n\n    _defineProperty(this, \"getUserDetails\", () => {\n      const {\n        userDetails\n      } = this.state;\n      const apiUrl = '/api/getUserDetails';\n      const fetchData = {\n        method: 'POST',\n        body: JSON.stringify({\n          userId: userDetails.userId\n        }),\n        headers: new Headers()\n      };\n      fetch(apiUrl, fetchData).then(res => res.json()).then(response => {\n        this.setState({\n          userDetails: response.data\n        });\n      });\n    });\n\n    _defineProperty(this, \"addToCart\", bookDetails => {\n      const {\n        bookList,\n        cart\n      } = this.state;\n\n      if (cart.length < 2 && bookDetails.availableQty > 0) {\n        if (cart.length === 0 || cart.length > 0 && cart.some(bookInCart => bookInCart.bookId !== bookDetails.bookId)) {\n          const updatedBookList = bookList.map(book => {\n            if (book.bookId === bookDetails.bookId) {\n              book.isSelected = 1;\n            }\n\n            return book;\n          });\n          this.setState({\n            bookList: updatedBookList,\n            cart: [...cart, bookDetails]\n          });\n        }\n      }\n    });\n\n    _defineProperty(this, \"removeFromCart\", bookDetails => {\n      const {\n        bookList,\n        cart\n      } = this.state;\n\n      if (cart.length > 0) {\n        const updatedBookList = bookList.map(book => {\n          if (book.bookId === bookDetails.bookId) book.isSelected = 0;\n          return book;\n        });\n        const updatedCart = cart.filter(item => item.bookId !== bookDetails.bookId);\n        this.setState({\n          bookList: updatedBookList,\n          cart: updatedCart\n        });\n      }\n    });\n\n    _defineProperty(this, \"borrowBook\", () => {\n      const {\n        cart,\n        userDetails\n      } = this.state;\n      const borrowApiUrl = '/api/borrowBooks';\n      const fetchData = {\n        method: 'PUT',\n        body: JSON.stringify({\n          cartData: cart,\n          userId: userDetails.userId\n        }),\n        headers: new Headers()\n      };\n      fetch(borrowApiUrl, fetchData).then(res => res.json()).then(response => {\n        if (response.maxLimit || response.existInBorrow) {\n          this.setState({\n            borrowMsg: response.data\n          });\n        } else {\n          this.getBooksList();\n          this.getUserDetails();\n          this.setState({\n            cart: [],\n            borrowMsg: response.data\n          });\n        }\n      });\n    });\n\n    _defineProperty(this, \"returnBook\", returnBook => {\n      const {\n        cart,\n        userDetails\n      } = this.state;\n      const borrowApiUrl = '/api/returnBook';\n\n      if (returnBook.bookId) {\n        const fetchData = {\n          method: 'PUT',\n          body: JSON.stringify({\n            cartData: returnBook,\n            userId: userDetails.userId\n          }),\n          headers: new Headers()\n        };\n        fetch(borrowApiUrl, fetchData).then(res => res.json()).then(response => {\n          this.getBooksList();\n          this.getUserDetails();\n          this.setState({\n            returnMsg: response.data\n          });\n        });\n      }\n    });\n\n    _defineProperty(this, \"toggleCart\", () => {\n      const {\n        showCart\n      } = this.state;\n      this.setState({\n        showCart: !showCart,\n        borrowMsg: ''\n      });\n    });\n\n    _defineProperty(this, \"toggleReturn\", () => {\n      const {\n        showReturn\n      } = this.state;\n      this.setState({\n        showReturn: !showReturn,\n        returnMsg: ''\n      });\n    });\n\n    this.state = {\n      cart: [],\n      bookList: [],\n      showCart: false,\n      showReturn: false,\n      userDetails: {\n        userId: 808,\n        userName: '',\n        bookIds: ''\n      },\n      borrowMsg: '',\n      returnMsg: '',\n      loadingState: false\n    };\n  }\n\n  componentDidMount() {\n    this.getBooksList();\n    this.getUserDetails();\n  }\n\n  render() {\n    const {\n      bookList = [],\n      cart = [],\n      showCart,\n      showReturn,\n      userDetails,\n      returnMsg,\n      borrowMsg,\n      loadingState\n    } = this.state;\n    let userBookIdList = [];\n    if (userDetails && userDetails.bookIds.length > 0) userBookIdList = userDetails.bookIds.includes(',') ? userDetails.bookIds.split(',') : [userDetails.bookIds];\n    const returnItemToShow = userBookIdList.length > 0 && bookList.length > 0 ? bookList.filter(book => book.bookId === parseInt(userBookIdList[0]) || book.bookId === parseInt(userBookIdList[1])) : [];\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: styles.listing,\n      children: [showCart && /*#__PURE__*/_jsxDEV(Slider, {\n        sliderItems: cart,\n        removeFromSlider: this.removeFromCart,\n        borrowBook: this.borrowBook,\n        hideSlider: this.toggleCart,\n        showCustomMsg: borrowMsg\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 21\n      }, this), showReturn && /*#__PURE__*/_jsxDEV(Slider, {\n        sliderTitleText: \"Return List\",\n        sliderItems: returnItemToShow,\n        removeFromSlider: this.returnBook,\n        borrowBook: this.borrowBook,\n        hideSlider: this.toggleReturn,\n        hideMainCta: true,\n        showCustomMsg: returnMsg\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 189,\n        columnNumber: 21\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles.listing__title,\n        children: \"Book Listing\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 199,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles.listing__cartReturn,\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          className: styles.listing__actionIcon,\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            src: \"https://res.cloudinary.com/abyy30/image/upload/v1608744183/bookReturn_rdtuxi.svg\",\n            onClick: () => this.toggleReturn()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 204,\n            columnNumber: 25\n          }, this), returnItemToShow.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n            children: returnItemToShow.length\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 205,\n            columnNumber: 57\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 203,\n          columnNumber: 21\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          className: styles.listing__actionIcon,\n          children: [/*#__PURE__*/_jsxDEV(\"img\", {\n            src: \"https://res.cloudinary.com/abyy30/image/upload/v1608742866/cartOutline_oewduu.svg\",\n            onClick: () => this.toggleCart()\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 208,\n            columnNumber: 25\n          }, this), cart.length > 0 && /*#__PURE__*/_jsxDEV(\"div\", {\n            children: cart.length\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 209,\n            columnNumber: 45\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 21\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles.listing__subTitle,\n        children: \"Hover or Tap to select your desired book\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: styles.listing__bookListWrap,\n        children: bookList.length > 0 ? bookList.map(book => {\n          if (book.availableQty > 0) {\n            return /*#__PURE__*/_jsxDEV(\"div\", {\n              className: styles.listing__bookWrap,\n              children: /*#__PURE__*/_jsxDEV(BookComp, {\n                bookDetails: book,\n                addToCart: this.addToCart,\n                removeFromCart: this.removeFromCart\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 222,\n                columnNumber: 45\n              }, this)\n            }, book.bookId, false, {\n              fileName: _jsxFileName,\n              lineNumber: 221,\n              columnNumber: 41\n            }, this);\n          }\n        }) : loadingState ? /*#__PURE__*/_jsxDEV(EmptyScreenWithMsg, {\n          textToShow: \"Loading...\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 38\n        }, this) : /*#__PURE__*/_jsxDEV(EmptyScreenWithMsg, {\n          textToShow: \"No book found\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 228,\n          columnNumber: 87\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 178,\n      columnNumber: 13\n    }, this);\n  }\n\n}\n\nexport default ListingModule;","map":{"version":3,"sources":["/Users/Abhipray 1/Desktop/MY home/mYY work/HEXAD_assignment/Hexad_trial_code/hexad/client/modules/listing/index.js"],"names":["React","Component","BookComp","EmptyScreenWithMsg","Slider","styles","ListingModule","constructor","props","setState","loadingState","apiUrl","fetch","then","res","json","response","bookList","data","userDetails","state","fetchData","method","body","JSON","stringify","userId","headers","Headers","bookDetails","cart","length","availableQty","some","bookInCart","bookId","updatedBookList","map","book","isSelected","updatedCart","filter","item","borrowApiUrl","cartData","maxLimit","existInBorrow","borrowMsg","getBooksList","getUserDetails","returnBook","returnMsg","showCart","showReturn","userName","bookIds","componentDidMount","render","userBookIdList","includes","split","returnItemToShow","parseInt","listing","removeFromCart","borrowBook","toggleCart","toggleReturn","listing__title","listing__cartReturn","listing__actionIcon","listing__subTitle","listing__bookListWrap","listing__bookWrap","addToCart"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport BookComp from '../../components/book'\nimport EmptyScreenWithMsg from '../../components/emptyScreenWithMsg';\nimport Slider from '../../components/Slider';\nimport styles from './styles.module.scss';\n\nclass ListingModule extends Component {\n    constructor(props) {\n        super(props);\n        this.state = {\n            cart: [],\n            bookList: [],\n            showCart: false,\n            showReturn: false,\n            userDetails: {\n                userId: 808,\n                userName: '',\n                bookIds: '',\n            },\n            borrowMsg: '',\n            returnMsg: '',\n            loadingState: false,\n        }\n    }\n\n    componentDidMount() {\n        this.getBooksList();\n        this.getUserDetails();\n    }\n\n    getBooksList = () => {\n        this.setState({\n            loadingState: true,\n        })\n        const apiUrl = '/api/getBooksList';\n        fetch(apiUrl).then(res => res.json())\n          .then(response => {\n            this.setState({\n                bookList: response.data,\n                loadingState: false,\n            })\n          })\n    }\n\n    getUserDetails = () => {\n        const { userDetails } = this.state;\n        const apiUrl = '/api/getUserDetails';\n\n        const fetchData = {\n            method: 'POST',\n            body: JSON.stringify({userId: userDetails.userId}),\n            headers: new Headers()\n          }\n        fetch(apiUrl, fetchData).then(res => res.json())\n          .then(response => {\n            this.setState({\n                userDetails: response.data,\n            })\n          })\n    }\n    \n    addToCart = bookDetails => {\n        const { bookList, cart } = this.state;\n        if (cart.length < 2 && bookDetails.availableQty > 0) {\n            if (cart.length === 0 || \n                (cart.length > 0 && \n                    cart.some(bookInCart => bookInCart.bookId !== bookDetails.bookId))) {\n                const updatedBookList = bookList.map(book => {\n                    if (book.bookId === bookDetails.bookId) {\n                        book.isSelected = 1\n                    }\n                    return book\n                })\n                this.setState({\n                    bookList: updatedBookList,\n                    cart: [...cart, bookDetails],\n                })\n            }\n        }\n    };\n\n    removeFromCart = bookDetails => {\n        const { bookList, cart } = this.state;\n        if (cart.length > 0) {\n            const updatedBookList = bookList.map(book => {\n                if (book.bookId === bookDetails.bookId)\n                    book.isSelected = 0\n                return book\n            })\n            const updatedCart = cart.filter(item => item.bookId !== bookDetails.bookId)\n            this.setState({\n                bookList: updatedBookList,\n                cart: updatedCart,\n            })\n        }\n    };\n\n    borrowBook = () => {\n        const { cart, userDetails } = this.state;\n        const borrowApiUrl = '/api/borrowBooks';\n        const fetchData = {\n            method: 'PUT',\n            body: JSON.stringify({cartData: cart, userId: userDetails.userId}),\n            headers: new Headers()\n          }\n        fetch(borrowApiUrl, fetchData).then(res => res.json())\n          .then(response => {\n            if (response.maxLimit || response.existInBorrow) {\n                this.setState({\n                    borrowMsg: response.data,\n                })\n            } else {\n                this.getBooksList();\n                this.getUserDetails();\n                this.setState({\n                    cart: [],\n                    borrowMsg: response.data,\n                })\n            }\n          })\n    };\n\n    returnBook = (returnBook) => {\n        const { cart, userDetails } = this.state;\n        const borrowApiUrl = '/api/returnBook';\n        if (returnBook.bookId) {\n            const fetchData = {\n                method: 'PUT',\n                body: JSON.stringify({cartData: returnBook, userId: userDetails.userId}),\n                headers: new Headers()\n              }\n            fetch(borrowApiUrl, fetchData).then(res => res.json())\n              .then(response => {\n                this.getBooksList();\n                this.getUserDetails();\n                this.setState({\n                    returnMsg: response.data,\n                })\n              })\n        }\n    };\n\n    toggleCart = () => {\n        const { showCart } = this.state;\n        this.setState({\n            showCart: !showCart,\n            borrowMsg: '',\n        })\n    };\n\n    toggleReturn = () => {\n        const { showReturn } = this.state;\n        this.setState({\n            showReturn: !showReturn,\n            returnMsg: '',\n        })\n    };\n\n    render() {\n        const { \n            bookList = [],\n            cart = [],\n            showCart,\n            showReturn,\n            userDetails,\n            returnMsg,\n            borrowMsg,\n            loadingState\n        } = this.state;\n\n        let userBookIdList = [];\n        if (userDetails && userDetails.bookIds.length > 0)\n            userBookIdList = userDetails.bookIds.includes(',') ? userDetails.bookIds.split(',') : [userDetails.bookIds];\n\n        const returnItemToShow = (userBookIdList.length > 0 && bookList.length > 0) ? bookList.filter(book => (book.bookId === parseInt(userBookIdList[0]) || book.bookId === parseInt(userBookIdList[1]))) : [];\n\n        return (\n            <div className={styles.listing}>\n                {showCart && \n                    <Slider \n                        sliderItems={cart}\n                        removeFromSlider={this.removeFromCart}\n                        borrowBook={this.borrowBook}\n                        hideSlider={this.toggleCart}\n                        showCustomMsg={borrowMsg} \n                    />\n                }\n                {showReturn &&\n                    <Slider\n                        sliderTitleText='Return List'\n                        sliderItems={returnItemToShow}\n                        removeFromSlider={this.returnBook}\n                        borrowBook={this.borrowBook}\n                        hideSlider={this.toggleReturn}\n                        hideMainCta\n                        showCustomMsg={returnMsg}\n                    />\n                }\n                <div className={styles.listing__title}>\n                    Book Listing\n                </div>\n                <div className={styles.listing__cartReturn}>\n                    <span className={styles.listing__actionIcon}>\n                        <img src=\"https://res.cloudinary.com/abyy30/image/upload/v1608744183/bookReturn_rdtuxi.svg\" onClick={() => this.toggleReturn()} />\n                        {returnItemToShow.length > 0 && <div>{returnItemToShow.length}</div>}\n                    </span>\n                    <span className={styles.listing__actionIcon}>\n                        <img src=\"https://res.cloudinary.com/abyy30/image/upload/v1608742866/cartOutline_oewduu.svg\" onClick={() => this.toggleCart()} />\n                        {cart.length > 0 && <div>{cart.length}</div>}\n                    </span>\n                </div>\n                <div className={styles.listing__subTitle}>\n                    Hover or Tap to select your desired book\n                </div>\n                <div className={styles.listing__bookListWrap}>\n                    {bookList.length > 0 ? \n                        bookList.map(book => \n                            {\n                                if (book.availableQty > 0) {\n                                    return (\n                                        <div className={styles.listing__bookWrap} key={book.bookId}>\n                                            <BookComp bookDetails={book} addToCart={this.addToCart} removeFromCart={this.removeFromCart} />\n                                        </div>\n                                    )\n                                }\n                            }\n                        )\n                    : loadingState ? <EmptyScreenWithMsg textToShow='Loading...' /> : <EmptyScreenWithMsg textToShow='No book found' />\n                    }\n                </div>\n            </div>\n        );\n    }\n}\n\nexport default ListingModule;"]},"metadata":{},"sourceType":"module"}